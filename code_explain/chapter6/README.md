# 第6章：Python错误处理和调试

在这一章中，我们将通过生动有趣的例子来学习Python的错误处理和调试技巧。就像生活中需要处理各种意外情况一样，程序也需要优雅地处理各种可能的错误。让我们开始探索如何让程序更加健壮和可靠！

## 1. 基本异常处理

异常处理就像是给程序安装安全气囊：
- 预防可能的错误（try）
- 处理不同类型的问题（except）
- 确保重要操作能完成（finally）

### 1.1 除法计算器示例
展示了如何：
- 处理输入错误（ValueError）
- 处理除零错误（ZeroDivisionError）
- 处理未知错误（Exception）
- 使用else和finally子句

## 2. 自定义异常

自定义异常就像是定制特殊的警报系统：
- 创建特定的错误类型
- 提供详细的错误信息
- 方便错误的分类和处理

### 2.1 银行账户示例
展示了如何：
- 创建余额不足异常
- 在取款操作中使用异常
- 提供友好的错误消息

## 3. 调试技巧

调试就像是程序的体检：
- 使用断言检查条件
- 记录程序运行状态
- 及时发现和修复问题

### 3.1 使用断言
断言就像是程序的"体温计"：
- 检查重要的前提条件
- 验证函数的输入参数
- 确保程序状态正确

### 3.2 使用日志
日志就像是程序的"病历本"：
- 记录程序的运行过程
- 不同级别的日志信息
- 帮助定位和分析问题

## 4. 上下文管理器

上下文管理器就像是自动门：
- 自动管理资源的获取和释放
- 确保资源正确关闭
- 优雅地处理异常情况

### 4.1 文件操作器示例
展示了如何：
- 自动打开和关闭文件
- 处理文件操作异常
- 确保资源正确释放

## 5. 综合示例：商品库存管理

将所有概念组合在一起：
- 异常处理
- 日志记录
- 资源管理

### 主要特点：

1. 异常层次结构：
   - 基础库存异常
   - 库存不足异常
   - 无效数量异常

2. 错误处理策略：
   - 参数验证
   - 业务逻辑检查
   - 异常传播

3. 日志记录：
   - 操作日志
   - 错误日志
   - 调试信息

4. 实际应用：
   - 添加商品
   - 减少库存
   - 查看库存

## 调试建议

1. **预防为主**：
   - 在可能出错的地方添加检查
   - 使用断言验证重要条件
   - 添加适当的日志记录

2. **分层处理**：
   - 在合适的层级处理异常
   - 避免吞掉异常
   - 提供有用的错误信息

3. **日志记录**：
   - 使用不同的日志级别
   - 记录关键操作和状态
   - 包含足够的上下文信息

4. **优雅恢复**：
   - 保持程序状态一致
   - 提供友好的错误消息
   - 正确清理资源

## 练习题

1. 创建一个文件处理程序，处理各种可能的文件操作错误
2. 实现一个简单的计算器，包含完整的错误处理
3. 为图书管理系统添加异常处理和日志记录
4. 创建一个带有重试机制的网络请求函数
5. 实现一个数据验证器，使用自定义异常处理无效数据

记住：好的错误处理能让程序更健壮、更可靠！调试工具和技巧是每个程序员的必备武器。 